<ons-page id="shiftPage">
  <style>
    #shiftPage .page__content {
      background: white !important;
    }
    .fc-header-toolbar {
      margin-bottom: 0.25em !important;
    }
    .fc-daygrid-body,
    .fc-col-header,
    .fc-scrollgrid-sync-table {
      width: 100% !important;
    }
  </style>
  <ons-toolbar>
    <div class="left" style="width:10%;">
      <ons-back-button> </ons-back-button>
    </div>
    <div
      class="center"
      id="toolbar-title"
      style="display:flex;align-items: center;justify-content: center;width:80%;"
    >
      シフト設定ページ
    </div>
    <div
      class="right"
      id="toolbar-title"
      style="display:flex;align-items: center;justify-content: center;width:10%;"
      onclick="window.location='index.html';"
    >
      <i class="fas fa-redo-alt"></i>
    </div>
  </ons-toolbar>
  <!--キャストを呼ぶ部分 -->
  <div id="calendar"></div>

  <div style="padding:0.5rem;margin-top:0rem;">
    <ons-button
      modifier="large"
      class="large-button-orange"
      onclick="scheduleEditPageJump();"
      >編集</ons-button
    >
  </div>
  <input type="hidden" id="selectDate" />
  <script>
    var user = firebase.auth().currentUser;
    myShiftDateGet();
    function myShiftDateGet() {
      $(".fc-daygrid-day-events").empty();
      db.collection("users")
        .doc(user.uid)
        .collection("shift")
        .get()
        .then(function(myShiftAll) {
          if (myShiftAll.size > 0) {
            myShiftAll.forEach(myShift => {
              var registerdDate = String(myShift.data().date);
              var date = strIns(registerdDate, 4, "-");
              var slashDate = strIns(date, 7, "-");
              var date = strIns(registerdDate, 4, "-");
              var startTime = String(myShift.data().startTime).slice(8);
              var startTime = strIns(startTime, 2, ":");
              var endTime = String(myShift.data().endTime).slice(8);
              var endTime = strIns(endTime, 2, ":");
              var circle =
                `
              <p style="display:flex;justify-content:center;align-items:center;margin:0px;font-size:0.8em;color:#ff9831">` +
                startTime +
                ` - ` +
                endTime +
                `</p>
            `;
              $(
                'td[data-date="' + slashDate + '"] .fc-daygrid-day-events'
              ).append(circle);
            });
          }
        })
        .catch(function(error) {
          console.log(error);
        });
    }

    function scheduleEditPageJump() {
      var selectDate = $("#selectDate").val();
      if (selectDate == "") {
        ons.notification.alert({
          message: "日付を選択してください"
        });
      } else {
        myNavigator.bringPageTop("html/shift/shiftEditPage.html");
        setTimeout(function() {
          getSchedule(selectDate);
        }, 500);
      }
    }
  </script>
</ons-page>
