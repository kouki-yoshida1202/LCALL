<ons-page id="woman-page">
  <ons-toolbar>
    <div class="left" id="toolbar-title">
      <ons-back-button></ons-back-button>
    </div>
    <div class="center navy-font" id="toolbar-title">
      Hanako
    </div>
  </ons-toolbar>
  <ons-bottom-toolbar
    style="background-color:#ff9831; text-align: center;color:white;line-height: 35px;"
    onclick="chatPageJump($('#womanPageWomanId').val());"
  >
    メッセージを送る
  </ons-bottom-toolbar>
  <div style="height:350px;position: relative;">
    <img
      id="womanImage"
      src="img/userSampleImageMan.png"
      alt=""
      style="width:100%;height:350px;object-fit:cover;"
    />
    <div
      style="position: absolute;bottom:20px;left: 50%;
        transform: translateX(-50%);
        -webkit-transform: translateX(-50%);
        -ms-transform: translateX(-50%);width:90%;background-color:rgba(255,152,49,0.2);font-weight: bold;height:60px;border-radius: 50px;margin:0 auto;"
    >
      <ons-row style="height:100%;width:90%;margin:0 auto;">
        <ons-col style="text-align: center;" vertical-align="center">
          <img src="img/starOn.png" alt="" style="height:35px;" />
        </ons-col>
        <ons-col style="text-align: center;" vertical-align="center">
          <img src="img/starOn.png" alt="" style="height:35px;" />
        </ons-col>
        <ons-col style="text-align: center;" vertical-align="center">
          <img src="img/starOn.png" alt="" style="height:35px;" />
        </ons-col>
        <ons-col style="text-align: center;" vertical-align="center">
          <img src="img/starOn.png" alt="" style="height:35px;" />
        </ons-col>
        <ons-col style="text-align: center;" vertical-align="center">
          <img src="img/starOff.png" alt="" style="height:35px;" />
        </ons-col>
      </ons-row>
    </div>
  </div>
  <!-- <ons-row style="width:85%;margin:0 auto;height:70px;">
    <ons-col style="text-align: center;" vertical-align="center">
      <img
        src="img/image61.jpg"
        alt=""
        style="height:45px;width:45px;border-radius:50%;object-fit: cover;"
      />
    </ons-col>
    <ons-col style="text-align: center;" vertical-align="center">
      <img
        src="img/image61.jpg"
        alt=""
        style="height:45px;width:45px;border-radius:50%;object-fit: cover;"
      />
    </ons-col>
    <ons-col style="text-align: center;" vertical-align="center">
      <img
        src="img/image61.jpg"
        alt=""
        style="height:45px;width:45px;border-radius:50%;object-fit: cover;"
      />
    </ons-col>
    <ons-col style="text-align: center;" vertical-align="center">
      <img
        src="img/image61.jpg"
        alt=""
        style="height:45px;width:45px;border-radius:50%;object-fit: cover;"
      />
    </ons-col>
    <ons-col style="text-align: center;" vertical-align="center">
      <img
        src="img/image61.jpg"
        alt=""
        style="height:45px;width:45px;border-radius:50%;object-fit: cover;"
      />
    </ons-col>
  </ons-row> -->
  <ons-card
    id="womanPageCarender"
    style="width:85%;margin:0 auto;margin-top:20px;"
  >
    <ons-row style="margin-bottom:15px;">
      <ons-col
        vertical-align="left"
        width="20%"
        style="text-align: left;"
        onclick="prevWeek()"
      >
        ＜ 前週
      </ons-col>
      <ons-col
        id="womanCalenderCenter"
        vertical-align="center"
        width="60%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        vertical-align="right"
        width="20%"
        style="text-align: right;"
        onclick="nextWeek()"
      >
        次週　＞
      </ons-col>
    </ons-row>
    <ons-row>
      <ons-col
        id="weekyoubi_1"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="weekyoubi_2"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="weekyoubi_3"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="weekyoubi_4"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="weekyoubi_5"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="weekyoubi_6"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="weekyoubi_7"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
    </ons-row>
    <ons-row>
      <ons-col
        id="week_1"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="week_2"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="week_3"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="week_4"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="week_5"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="week_6"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
      <ons-col
        id="week_7"
        vertical-align="center"
        width="14.2%"
        style="text-align: center;"
      >
      </ons-col>
    </ons-row>
    <ons-row id="womanCarenderOnOff" style="margin-top:7px;">
      <ons-col
        id="OnOff1"
        vertical-align="center"
        width="14.2%"
        style="text-align:center;"
      ></ons-col>
      <ons-col
        id="OnOff2"
        vertical-align="center"
        width="14.2%"
        style="text-align:center;"
      ></ons-col>
      <ons-col
        id="OnOff3"
        vertical-align="center"
        width="14.2%"
        style="text-align:center;"
      ></ons-col>
      <ons-col
        id="OnOff4"
        vertical-align="center"
        width="14.2%"
        style="text-align:center;"
      ></ons-col>
      <ons-col
        id="OnOff5"
        vertical-align="center"
        width="14.2%"
        style="text-align:center;"
      ></ons-col>
      <ons-col
        id="OnOff6"
        vertical-align="center"
        width="14.2%"
        style="text-align:center;"
      ></ons-col>
      <ons-col
        id="OnOff7"
        vertical-align="center"
        width="14.2%"
        style="text-align:center;"
      ></ons-col>
    </ons-row>
  </ons-card>
  <ons-card style="width:85%;margin:0 auto;margin-top:20px;">
    <ons-row>
      <ons-col width="70%">
        <h4><span id="womanUserName"></span> <span id="womanOld"></span></h4>
      </ons-col>
      <ons-col vertical-align="center" width="30%" style="text-align: right;">
        <span
          id="womanClass"
          style="font-size:0.8em;background-color: #ff9831;color:white;border-radius: 10px;padding:7px 10px;"
        >
          クラス
        </span>
      </ons-col>
    </ons-row>
    <p id="womanText" class="light-navy" style="font-size:0.8em;"></p>
  </ons-card>
  <ons-card style="width:85%;margin:0 auto;margin-top:20px;margin-bottom:30px;">
    <ons-list-item>
      <div class="left">
        <i class="fas fa-male fa-fw" style="color:#ff9831;"></i>
      </div>
      <div class="center navy-font">
        身長
      </div>
      <div id="womanHeight" class="right light-navy-font"></div>
    </ons-list-item>
    <ons-list-item>
      <div class="left">
        <i class="fas fa-home fa-fw" style="color:#ff9831;"></i>
      </div>
      <div class="center navy-font">
        居住地
      </div>
      <div id="womanAddress" class="right light-navy-font"></div>
    </ons-list-item>
    <ons-list-item>
      <div class="left">
        <i class="fas fa-map-pin fa-fw" style="color:#ff9831;"></i>
      </div>
      <div class="center navy-font">
        出身地
      </div>
      <div id="womanBirthPlace" class="right light-navy-font"></div>
    </ons-list-item>
    <ons-list-item>
      <div class="left">
        <i class="fas fa-briefcase fa-fw" style="color:#ff9831;"></i>
      </div>
      <div class="center navy-font">
        仕事
      </div>
      <div id="womanWork" class="right light-navy-font"></div>
    </ons-list-item>
    <ons-list-item>
      <div class="left">
        <i class="fas fa-beer fa-fw" style="color:#ff9831;"></i>
      </div>
      <div class="center navy-font">
        おさけ
      </div>
      <div id="womanAlcohol" class="right light-navy-font"></div>
    </ons-list-item>
    <ons-list-item>
      <div class="left">
        <i class="fas fa-smoking fa-fw" style="color:#ff9831;"></i>
      </div>
      <div class="center navy-font">
        たばこ
      </div>
      <div id="womanTobacco" class="right light-navy-font"></div>
    </ons-list-item>
    <ons-list-item>
      <div class="left">
        <i class="fas fa-user fa-fw" style="color:#ff9831;"></i>
      </div>
      <div class="center navy-font">
        髪型
      </div>
      <div id="womanHairStyle" class="right light-navy-font"></div>
    </ons-list-item>
    <ons-list-item>
      <div class="left">
        <i class="fas fa-paint-brush fa-fw" style="color:#ff9831;"></i>
      </div>
      <div class="center navy-font">
        髪の色
      </div>
      <div id="womanHairColor" class="right light-navy-font"></div>
    </ons-list-item>
  </ons-card>
  <input type="hidden" id="nowDateTime" />
  <input type="hidden" id="womanPageWomanId" />
  <script>
    function womanInfoGet(userId) {
      $("#womanPageWomanId").val(userId);
      db.collection("users")
        .doc(userId)
        .get()
        .then(function(womanResult) {
          $("#womanHeight").html(womanResult.data().height);
          $("#womanAddress").html(womanResult.data().address);
          $("#womanAlcohol").html(womanResult.data().alcohol);
          $("#womanBirthPlace").html(womanResult.data().birthplace);
          $("#womanHairColor").html(womanResult.data().haircolor);
          $("#womanHairStyle").html(womanResult.data().hairstyle);
          $("#womanTobacco").html(womanResult.data().tobacco);
          $("#womanWork").html(womanResult.data().work);
          $("#womanUserName").html(womanResult.data().username);
          $("#womanOld").html(womanResult.data().old + "才");
          $("#womanClass").html(womanResult.data().class + "クラス");
          $("#womanText").html(womanResult.data().text);
          firebase
            .storage()
            .ref()
            .child("profilePicture/" + userId)
            .getDownloadURL()
            .then(url => {
              // 画像取得できた
              return url;
            })
            .catch(function() {
              // 画像取得できないとき
              url = "img/userSampleImageMan.png";
              return url;
            })
            .then(function(url) {
              $("#womanImage").attr("src", url);
            });
          return womanResult;
        })
        .then(function(womanResult) {
          showWomanLoad();
          var dt = new Date();
          var y = dt.getFullYear();
          var m = ("00" + (dt.getMonth() + 1)).slice(-2);
          var d = ("00" + dt.getDate()).slice(-2);
          var day = Number(d);
          $("#nowDateTime").val(Number(y + m + d));
          $("#womanCalenderCenter").html(y + "月" + m + "日");
          // Dateオブジェクトには実際の月ー１の値を指定するため
          var jsMonth = m - 1;
          var dayOfWeekStrJP = ["日", "月", "火", "水", "木", "金", "土"];
          var nextCounter = 1;
          var womanUserId = $("#womanPageWomanId").val();
          for (var j = 0; j < 7; j++) {
            if (j > 0) {
              dt.setDate(dt.getDate() + 1);
            }
            var y = dt.getFullYear();
            var m = ("00" + (dt.getMonth() + 1)).slice(-2);
            var d = ("00" + dt.getDate()).slice(-2);
            womanCarenderInfo(y, m, d, womanUserId, j);
            var jsMonth = m - 1;
            var date = new Date(y, jsMonth, d);
            $("#week_" + nextCounter).html(d);
            $("#weekyoubi_" + nextCounter).html(dayOfWeekStrJP[date.getDay()]);
            nextCounter++;
          }
        })
        .catch(function(error) {
          console.log(error);
          hideWomanLoad();
        });
    }
    function womanCarenderInfo(y, m, d, womanUserId, j) {
      var searchDate = Number(y + m + d);
      var calenderCounter = 0;
      db.collection("users")
        .doc(womanUserId)
        .collection("shift")
        .where("date", "==", searchDate)
        .get()
        .then(function(results) {
          if (results.size > 0) {
            var calenderlist = `
              <i class="far fa-circle" style="color:#ff9831"></i>
            `;
          } else {
            var calenderlist = `
              <i class="fas fa-slash" style="color:gray"></i>
            `;
          }

          $("#OnOff" + Number(j + 1)).html(calenderlist);
          if (j == 6) {
            hideWomanLoad();
          }
        })
        .catch(function(error) {
          console.log(error);
        });
    }

    function nextWeek() {
      showWomanLoad();
      var nowDateTime = $("#nowDateTime").val();
      nowDateTime = strIns(nowDateTime, 4, "/");
      nowDateTime = strIns(nowDateTime, 7, "/");
      var dt = new Date(nowDateTime);
      dt.setDate(dt.getDate() + 7);
      var y = dt.getFullYear();
      var m = ("00" + (dt.getMonth() + 1)).slice(-2);
      var d = ("00" + dt.getDate()).slice(-2);
      var day = Number(d);
      $("#nowDateTime").val(Number(y + m + d));
      $("#womanCalenderCenter").html(y + "年" + m + "月");
      // Dateオブジェクトには実際の月ー１の値を指定するため
      var jsMonth = m - 1;
      var dayOfWeekStrJP = ["日", "月", "火", "水", "木", "金", "土"];
      var nextCounter = 1;
      var womanUserId = $("#womanPageWomanId").val();
      for (var j = 0; j < 7; j++) {
        if (j > 0) {
          dt.setDate(dt.getDate() + 1);
        }
        var y = dt.getFullYear();
        var m = ("00" + (dt.getMonth() + 1)).slice(-2);
        var d = ("00" + dt.getDate()).slice(-2);
        womanCarenderInfo(y, m, d, womanUserId, j);
        var jsMonth = m - 1;
        var date = new Date(y, jsMonth, d);
        $("#week_" + nextCounter).html(d);
        $("#weekyoubi_" + nextCounter).html(dayOfWeekStrJP[date.getDay()]);
        nextCounter++;
      }
    }
    function prevWeek() {
      showWomanLoad();
      var nowDateTime = $("#nowDateTime").val();
      nowDateTime = strIns(nowDateTime, 4, "/");
      nowDateTime = strIns(nowDateTime, 7, "/");
      var dt = new Date(nowDateTime);
      dt.setDate(dt.getDate() - 7);
      var y = dt.getFullYear();
      var m = ("00" + (dt.getMonth() + 1)).slice(-2);
      var d = ("00" + dt.getDate()).slice(-2);
      $("#nowDateTime").val(Number(y + m + d));
      var womanUserId = $("#womanPageWomanId").val();

      var day = Number(d);
      $("#womanCalenderCenter").html(y + "月" + m + "日");
      var jsMonth = m - 1;
      var dayOfWeekStrJP = ["日", "月", "火", "水", "木", "金", "土"];
      var prevCounter = 1;

      for (var j = 0; j < 7; j++) {
        if (j > 0) {
          dt.setDate(dt.getDate() + 1);
        }
        var y = dt.getFullYear();
        var m = ("00" + (dt.getMonth() + 1)).slice(-2);
        var d = ("00" + dt.getDate()).slice(-2);
        womanCarenderInfo(y, m, d, womanUserId, j);
        var jsMonth = m - 1;
        var date = new Date(y, jsMonth, d);
        $("#week_" + prevCounter).html(d);
        $("#weekyoubi_" + prevCounter).html(dayOfWeekStrJP[date.getDay()]);
        prevCounter++;
      }
    }

    function showWomanLoad() {
      $("#womanPageCarender").LoadingOverlay("show", {
        image: "",
        fontawesome: "fa fa-spinner fa-spin fa-small"
      });
      setTimeout(function() {
        hideWomanLoad();
      }, 5000);
    }

    function hideWomanLoad() {
      $("#womanPageCarender").LoadingOverlay("hide");
    }
  </script>
</ons-page>
